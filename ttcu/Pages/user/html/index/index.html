<!DOCTYPE html>
<html>

<head>
    <title>خانه</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bitter:400,700">
    <link rel="stylesheet" href="/ttcu/src/css/main.css">
    <link rel="stylesheet" href="indexuser.css">

    <link rel="stylesheet" href="/ttcu/src/footer.css">
    <link rel="stylesheet" href="darkmode/moon.css">
    <link rel="stylesheet" href="../../../../src/css/updatepost.css">
    <link rel="stylesheet" href="../../../../src/css/showpost.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel=icon href="aa0r2-xtkx1.ico">
    <script src="https://kit.fontawesome.com/fc383a6465.js" crossorigin="anonymous"></script>
    <script src="https://cdn.ckeditor.com/ckeditor5/11.0.1/classic/ckeditor.js"></script>
 


</head>

<body>


  <div class="grid-header">
    <div>
        <div class="header-dark">
            <div class="header" id="myHeader">  
                          <nav class="navbar navbar-dark navbar-expand-md navigation-clean-search">
                <div class="container"><img src="Icon.png"><a class="navbar-brand" href="/ttcu/public/index.html">TTCU </a>
                    
                
                    <button class="navbar-toggler" data-toggle="collapse" data-target="#navcol-1">
                        <span class="sr-only">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
                    <div class="collapse navbar-collapse" id="navcol-1">

                      <ul class="nav navbar-nav">
                        <li class="nav-item" role="presentation">  
                            <div class="moon" onclick="myFunction()" class= dark-mode ></div></li>

                            <li class="nav-item" role="presentation"><a class="nav-link" href="/ttcu/Pages/user/html/index/index.html">خانه</a></li>
                            <li class="nav-item" role="presentation"><a class="nav-link" href="/ttcu/Pages/about/about.html">درباره ما</a></li>

                            <li class="nav-item" role="presentation"><a class="nav-link" href="/ttcu/Pages/blog/blogpage.html">بلاگ</a></li>
                            <li class="nav-item" role="presentation"><a class="nav-link" href="/ttcu/Pages/contact-us/contact.html">تماس باما</a></li>
                            <li class="dropdown"><a class="dropdown-toggle nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" >مشاهده پست ها </a>
                              <div class="dropdown-menu" role="menu">
                                <a class="dropdown-item" role="presentation" href="/ttcu/Pages/postpage/bestPost.html">منتخب برای شما</a>
                                <a class="dropdown-item" role="presentation" href="/ttcu/Pages/postpage/showpost.html">جستجوی پست</a>

                              </div>
                            </li>
                          
                          
                    </ul>
                        <form class="form-inline mr-auto" target="_self">  </form>
                          
                        <span class="navbar-text">
                            <a href="../../../userinfo/userinfo.html"  ><img src="../../../../src/img/per.PNG"></a>
                            <a id="signupLink" class="btn btn-light action-button" role="button" href="../../../signup/Signup.html" style="visibility: hidden;">ثبت نام اعضاء</a>
                            </span>

                        
                 
            </nav>
        </div>
    </div>
</div>
</div>

<div class="grid-container">
<div class="grid-img">

    <div class="row" style="align-content: center;">
        <div class="leftcolumn" id="posts">
        </div>
      
      
      
      
        <div class="rightcolumn">
      
          <div class="card" style="width:400px;text-align: center;">
            <h4>پیش نمایش پست ها</h4>
            <div class="fakeimg" id="top"></div>
          </div>
      
        </div>
        <a href="/ttcu/Pages/postpage/makepost.html">
        <button  id="myBtn" title="ساخت پست جدید" class="newpost">+</button></a>



       <!-- <div >
      
          <div class="card" style="width:500px;text-align: center;">
            <a href="../../../postpage/makepost.html">ارسال پست جدید</a>
          </div>
      
        </div>

    </div>
      
   
    -->

</div>
</div>











<script>

function loadPosts(){

var detailArr={};
var xmlhttp;
if(window.XMLHttpRequest){
 xmlhttp=new XMLHttpRequest;
}
else{
    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
}
xmlhttp.onreadystatechange=respond;
function respond (){
if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
  
  var response = JSON.parse(this.responseText);
    if(response.code == 200){
        
        let len = response.object.length;
        let text ="";
        let images="";
        if(len==0)
        {
          text="<div class='card w-75' style='text-align: center;'>"+
                   "<div class='card-body'>"+
                    "<img src='../../../../src/img/notFound.png' height='100px' width='100px'>"+
                     "<h5 class='card-title'>هیچ پستی برای نمایش یافت نشد</h5>"+
                     "<h7 class='card-text'>شما هنوز پستی در صفحه خود ایجاد نکرده اید، برای ایجاد پست لینک زیر را دنبال کنید</h7>"+
                     "<p></p>"+
                     "<a href='../../../postpage/makepost.html' class='btn btn-primary'>ثبت پست جدید</a>"+
                   "</div>"+
                "</div>"
        }
        for (let i = 0; i < len; i++) {
          var randomPic=choosePic(response.object[i].postType);
             text +=
  "  <div id='post"+i+"' class='card'>"+
   "   <div class='button' style='text-align:left; padding-top: 0px;'>"+
    "    <a class='edit' onclick='enableUpdate()'><img src='https://img.icons8.com/ios-glyphs/30/000000/edit--v4.png'/>ویرایش</a>"+
     "   <a id='edit"+i+"' class='save' onclick='update(this)'><img src='https://img.icons8.com/ios-glyphs/30/000000/save--v1.png'/>ذخیره تغییرات</a>"+
        
      "</div>"+


"<div class='content-area' style='padding-right:1px;  text-align: right;direction: rtl;'>"+

"<div class='row'>"+

 " <div class='field'>"+
  "  <label style='text-align: right; '>عنوان</label>"+
   " <input id='textId"+i+"'  type='text' class='text1'  style='font-size: 25px;' value='"  + response.object[i].title +"' autocomplete='off' disabled='true' />"+
  "</div>"+
"</div>"+

  
"<div class='row'>"+
 " <div class='field'>"+
  "  <label style='text-align: right;'>نوع پست </label>";
  if(window.localStorage.getItem('userType')=='STUDENT')
  {
    text+="<select id='postType"+i+"'  name='postTypes' dir='rtl' disabled='true' >"+
                "<option value='" +response.object[i].postType + "' disabled='disabled' selected='selected'>" +convertPostType(response.object[i].postType) + "</option>"+
                "<option value='MASTERS_NOTES'>جزوات اساتید</option>"+   
                "<option value='ENTRANCE_EXAM_GUIDANCE'>راهنمای کنکور کاردانی به کارشناسی</option>"+
                "<option value='STUDENT_SERVICES'>خدمات دانشجویی</option>"+
                "</select>"
  }else
  {
    text+="<select id='postType"+i+"'  name='postTypes' dir='rtl' disabled='true'>"+
                "<option value='" +response.object[i].postType+ "' disabled='disabled' selected='selected'>" +convertPostType(response.object[i].postType) + "</option>"+
                "<option value='INVITATION'>فراخوان</option>"+
                "<option value='BEST_PROJECTS'>بهترین پایان نامه ها</option>"+
                "<option value='NEWS'>اخبار دانشگاهی</option>"+
			        	"<option value='TOP_ENTRIES'>رتبه های برتر کنکور</option>"+
                "<option value='MASTERS_NOTES'>جزوات اساتید</option>"+   
                "<option value='ENTRANCE_EXAM_GUIDANCE'>راهنمای کنکور کاردانی به کارشناسی</option>"+
                "<option value='STUDENT_SERVICES'>خدمات دانشجویی</option>"+
                "</select>"
  }
   text+=
  "</div>"+
  "</div>"+

  "<div class='row'  >"+
   " <div class='field'>"+
    "  <label style='padding-bottom: 10px;'>کد پست</label>"+
    "<p id='postId"+i+"'>"  + response.object[i].id +"</p>"+
    "</div>"+
    "</div>"+

  "<div class='row'  >"+
  "<div class='field'>"+
   "       <label style='padding-bottom: 10px;' >نام کاربری</label>"+
    "<p id='username"+i+"' >@" + response.object[i].username +"</p>"+
    "</div>"+
    "</div>"+
    "<div class='row'  style='padding-bottom:10px';>"+

     "   <div class='field'>"+
      "    <label style='padding-bottom: 10px;'>نوع کاربر</label>"+

  "<p id='userType"+i+"'>"  + convertUserType(response.object[i].userType) +"</p>"+
   "     </div>"+

"</div>"+


"<div class='row'>"+
  "<div class='field'>"+
    "<label style='text-align: right;'>رشته</label>"+
    "<select id='major"+i+"' required='required' name='UniversityMajor' dir='rtl' disabled='true' >"+
	  "<option value='"  + response.object[i].uniMajor.major +"' disabled='disabled' selected='selected'>"  + convertMajor(response.object[i].uniMajor.major) +" </option>"+
      "<option value='SOFTWARE'>نرم افزار</option>"+
      "<option value='ELECTRONICS'>الکترونیک</option>"+
      "<option value='MECHANICS'>مکانیک</option>"+
      "<option value='ICT'>ICT</option>"+
      "<option value='ARCHITECTURE'>نقشه کشی معماری</option>   "+
      "<option value='GRAPHICS'>گرافیک</option>"+
      "<option value='ACCOUNTING'>حسابداری</option>"+
      "<option value='CLOTHING_DESIGN'>طراحی دوخت</option>"+
      "<option value='PHYSICAL_EDUCATION'>تربیت بدنی</option>"+
      "<option value='IT'>IT</option>"+
    "</select>"+
  
  "</div>"+
"</div>"+

"<div class='row'>"+
  "<div class='field'>"+
  "<label style='text-align: right;'>دانشگاه</label>"+
  "<select id='uni"+i+"' required='required' name='University' dir='rtl' disabled='true' >"+
  	"<option value='"  + response.object[i].uniMajor.uni +"' disabled='disabled' selected='selected'>"  + convertUni(response.object[i].uniMajor.uni) +" </option>"+
    "<option value='SHARIATY_TECHNICAL_COLLEGE'>دانشکده فنی دکتر شریعتی</option>"+
    "<option value='VALIASR_TECHNICAL_COLLEGE'> دانشکده فنی ولیعصر</option>"+
    "<option value='ENGHELAB_TECHNICAL_COLLEGE'>دانشکده فنی انقلاب اسلامی</option>"+
    "<option value='SHAMSIPOUR_TECHNICAL_COLLEGE'>دانشکده فنی شمسی پور</option>"+
  "</select>"+
"</div>"+
"</div>"+


 "   <div class='row'>"+
  "    <div  id='image'><img  class='fakeimg'   height='400' id='postImage' src='"+randomPic+"'></div>"+

   "   <div class='field'>"+

    "    <fieldset>"+
     "    <label style='text-align: right;'>توضیحات</label>"+
      "   <br>"+

       "  <div class='form-box'  style='text-align: right; direction: rtl;'>"+
        " <textarea  id='description"+i+"' id='editor' cols='90'  placeholder='توضیحات' style='  width: 100%;  padding: 12px;"+
         "border: 1px solid rgba(155, 155, 155, 0.645);"+
         "border-radius:4 px;"+
         "box-sizing: border-box;"+
         "resize: vertical;' disabled='true'> "  + response.object[i].description +"  </textarea>"+                
         "</div>"+

       "</fieldset>"+
       
       "</div>"+
     "</div>"+


    "<div class='row'>"+

     " <div class='field' style='padding-left:70%;' >"+
    "<label style='text-align: right;' style='padding-right:50px;' disabled='true'>تلفن:</label>"+
    "<input  id='contact"+i+"' type='text' value='"+response.object[i].contact +"' />"+
  "</div>"+
  "<h6>تاریخ :"+response.object[i].pDate+"  "+response.object[i].pTime+"</h6></div>"+
 "</div>"+
 " <a   data-toggle='modal' data-target='#exampleModalCenter' style='text-align: l;'>"+ 
    "  <img src='https://img.icons8.com/ios/30/000000/delete-forever.png'/>حذف</a>"+

  "  </div>"+

   

  "</div>"+

  "</div>"+


                     "<!-- Modal -->"+
"<div class='modal fade' id='exampleModalCenter' tabindex='-1' role='dialog' aria-labelledby='exampleModalCenterTitle' aria-hidden='true'>"+
  "<div class='modal-dialog modal-dialog-centered' role='document'>"+
    "<div class='modal-content'>"+
      "<div class='modal-header' style='text-align: right;'>"+
        "<h5 class='modal-title' id='exampleModalCenterTitle'> حذف</h5>"+
        "<button type='button' class='close' data-dismiss='modal' aria-label='Close'>"+
          "<span aria-hidden='true'>&times;</span>"+
        "</button>"+
      "</div>"+
      "<div class='modal-body'>"+
        "<p style='text-align: right;'> آیا واقعاً می خواهید این پست را حذف کنید؟ این روند قابل برگشت نیست</p>"+
      "</div>"+
      "<div class='modal-footer'>"+
        "<button type='button' class='btn btn-secondary' data-dismiss='modal'>بستن </button>"+
        "<button type='button' class='btn btn-primary' onclick='deletePost(this)' id='card"+i+"' >حذف</button>"+
      "</div>"+
    "</div>"+
  "</div>"+
"</div>"+
                    "<!--modal--->";

              images+="<a href=\"#post"+i+"\">"+response.object[i].title+"</a><br>";
            
            }
            
            document.getElementById("posts").innerHTML = text;
            document.getElementById("top").innerHTML = images;
            
     
    }else {
      window.location = 'welcome.html';

    }

}
else if( xmlhttp.status == 403){
    window.location = 'login.html';
  
  } 
else{
  console.log("Hello");

}

}


xmlhttp.open('GET','http://127.0.0.1:8082/api/userPostInquiry',true);
xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));

xmlhttp.send(JSON.stringify(detailArr));
}

</script>


<script>

  function deletePost(element){
  var cardId=element.getAttribute('id').replace('card','');
  
  var id = document.getElementById("postId"+cardId);

  var detailArr={};
  detailArr["id"]=id.innerHTML.replace(' کد پست:','');
  var xmlhttp;
  if(window.XMLHttpRequest){
   xmlhttp=new XMLHttpRequest;
  }
  else{
      xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
  xmlhttp.onreadystatechange=respond;
  function respond (){
  if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
    
    var response = JSON.parse(this.responseText);
      if(response.code == 200){
         
        location.reload();
       
      }else {
        window.location = 'welcome.html';
  
      }
  
  }
  else if( xmlhttp.status == 403){
    window.location = '../../../login/login.html';
  
  }
  
  else{
    console.log("Wait");
  
  }
  
  }
  
  
  xmlhttp.open('POST','http://127.0.0.1:8082/api/postDelete',true);
  xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
  xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));
  
  xmlhttp.send(JSON.stringify(detailArr));
  }


  
  </script>


<script>

  function update(element){
  var cardId=element.getAttribute('id').replace('edit','');
  
  var id = document.getElementById("postId"+cardId).innerHTML;
  var postType=document.getElementById("postType"+cardId).value;
  var uni=document.getElementById("uni"+cardId).value;
  var major=document.getElementById("major"+cardId).value;
  var title=document.getElementById("textId"+cardId).value;
  var description=document.getElementById("description"+cardId).value;
  var contact=document.getElementById("contact"+cardId).value;


  var detailArr={};
  var uniMajor={};
  uniMajor["uni"]=uni;
  uniMajor["major"]=major;

  detailArr["id"]=id;
  detailArr["postType"]=postType;
  detailArr["title"]=title;
  detailArr["description"]=description;
  detailArr["contact"]=contact;
  detailArr["uniMajor"]=uniMajor;
  console.log(JSON.stringify(detailArr));
  var xmlhttp;
  if(window.XMLHttpRequest){
   xmlhttp=new XMLHttpRequest;
  }
  else{
      xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
  xmlhttp.onreadystatechange=respond;
  function respond (){
  if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
    
    var response = JSON.parse(this.responseText);
      if(response.code == 200){
        
        window.location.reload(true);
       
      }else {
        window.location = 'welcome.html';
  
      }
  
  }
  else if( xmlhttp.status == 403){
    window.location = 'login.html';
  
  }
  
  else{
    console.log("Hello");
  
  }
  
  }
  
  
  xmlhttp.open('POST','http://127.0.0.1:8082/api/postUpdate',true);
  xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
  xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));
  
  xmlhttp.send(JSON.stringify(detailArr));
  }
  
  </script>


<script>
  loadUserInfo();
      function loadUserInfo(){
      var detailArr={};
      var xmlhttp;
      if(window.XMLHttpRequest){
       xmlhttp=new XMLHttpRequest;
      }
      else{
          xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
      }
      xmlhttp.onreadystatechange=respond;
      function respond (){
      
      if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
        
        var response = JSON.parse(this.responseText);
          if(response.code == 200){
            
              var info = response.object;
              let userType=info.userType;
              if(userType=='ADMIN'||userType=='MASTER')
              {
                document.getElementById("signupLink").style.visibility = 'visible';
              }
             window.localStorage.setItem('userType',userType);
              loadPosts();
              
          
           
          }else {
            window.location = 'welcome.html';
      
          }
          }
      
      else if( xmlhttp.status == 403){
      window.location = '../../../login/login.html';
    
    } else{
        console.log("Wait");
      
      }
      
      }
      
      
      xmlhttp.open('GET','http://127.0.0.1:8082/api/getUserInfo',true);
      xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
      xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));
      
      xmlhttp.send(JSON.stringify(detailArr));
      }
      
      </script>
  <script>
    function choosePic(postType) {
     
     return "../../../../src/img/post/"+postType+"/1.jpg";
    }
  </script>
  







    <script src="../../../../src/app/updatepost.js"></script>
    <script src="../../../../src/app/enumConverter.js"></script>
    <script src="darkmode/darkmod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
    <!----->
    













</body>

</html>