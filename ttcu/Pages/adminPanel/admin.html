<!DOCTYPE html>
<html lang="en" >
  <head>
    <meta charset="UTF-8">
    <title>پنل مدیریت</title>
    <link rel="stylesheet" href="admin.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"/>
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
     <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bitter:400,700">
     <link rel="stylesheet" href="/ttcu/src/css/main.css">
     <link rel="stylesheet" href="/ttcu/src/css/mainstyle.css">  
     <link rel="stylesheet" href="/ttcu/src/css/scroll.css">  
     <link rel="stylesheet"   href="/ttcu/src/css/modal.css">
     <link rel="stylesheet" href="/ttcu/public/darkmode/moon.css">
    <link rel="stylesheet" href="/ttcu/src/footer.css">
    <link rel=icon href="../../src/Logo/ttcu-icon.ico"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"/>
 
 </head>
<body>
    <div class="scroll-button">  </div>

     <div class="grid-header">
        <div>
            <div class="header-dark">
                <div class="header" id="myHeader">  
                              <nav class="navbar navbar-dark navbar-expand-md navigation-clean-search">
                    <div class="container"><img src="/ttcu/public/Icon.png"><a class="navbar-brand" href="#">TTCU </a>
                        
                    
                        <button class="navbar-toggler" data-toggle="collapse" data-target="#navcol-1">
                            <span class="sr-only">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
                        <div class="collapse navbar-collapse" id="navcol-1">
    
    
                            <ul class="nav navbar-nav">
                                <li class="nav-item" role="presentation">  
                                    <div class="moon" onclick="myFunction()" class= dark-mode ></div></li>
    
                                
                                    <li class="nav-item" role="presentation"><a class="nav-link" href="/ttcu/public/index.html">خانه</a></li>
                                    <li class="nav-item" role="presentation"><a class="nav-link" href="/ttcu/Pages/about/about.html">درباره ما</a></li>
        
                                    <li class="nav-item" role="presentation"><a class="nav-link" href="/ttcu/Pages/blog/blogpage.html">بلاگ</a></li>
        
                                    <li class="nav-item" role="presentation"><a class="nav-link" href="/ttcu/Pages/contact-us/contact.html">تماس باما</a></li>
        
                             
    
    
                             
                            </ul>
    
    
    
    
    

                            <form class="form-inline mr-auto" target="_self">  </form>
                          
                            <span class="navbar-text">
    
                                <a id="signupLink" class="btn btn-light action-button" role="button" href="/ttcu/Pages/signup/Signup.html" >ثبت نام اعضاء</a>
                                <!-- <a  class="login"></a></span> </span>-->
                     
         </nav>
            </div>
        </div>
    </div>
    </div> 
<!-------------------------------------------------------------->
<div class="app-container">
    <div class="app-header">
      <div class="app-header-left">
        <span class="app-icon"></span>
        <p class="app-name">پنل مدیران</p>

      </div>
      <div class="app-header-right">
        <button class="mode-switch" title="Switch Theme">
       
        </button>
        <a href="/ttcu/Pages/signup/Signup.html">
        <button class="add-btn" title="پست جدبد">
          <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus">
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" /></svg>
        </button>
    </a>
        <button class="profile-btn">
            <img src="https://img.icons8.com/windows/32/000000/user-male-circle.png"/>
             <span id="adminName" style="font-family: IranianSans;"> </span>
        </button>
      </div>
 
    </div>
    <div class="app-content">
      <div class="app-sidebar">
        <a href="/ttcu/Pages/user/html/index/index.html" class="app-sidebar-link active" title=" خانه کاربر">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            <polyline points="9 22 9 12 15 12 15 22" /></svg>
        </a>
       
        <a href="/ttcu/Pages/userinfo/userinfo.html" class="app-sidebar-link" title="اطلاعات کاربر">
          <svg class="link-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="feather feather-settings" viewBox="0 0 24 24">
            <defs />
            <circle cx="12" cy="12" r="3" />
            <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z" />
          </svg>
        </a>
      </div>
      <div id="users" class="projects-section">
        <div class="projects-section-header">
          <p>اعضاء</p>
          <p class="time"></p>
        </div>
        <div class="projects-section-line">
          <div class="projects-status">
            <div class="item-status">
              <span id="posts" class="status-number"></span>
              <span class="status-type">پست</span>
            </div>
            <div class="item-status">
              <span id="teachers" class="status-number"></span>
              <span  class="status-type">استاد</span>
            </div>
            <div class="item-status">
              <span id="students" class="status-number"></span>
              <span class="status-type">دانشجو</span>
            </div>
          </div>
          <div class="view-actions">
            <button class="view-btn list-view" title="List View">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list">
                <line x1="8" y1="6" x2="21" y2="6" />
                <line x1="8" y1="12" x2="21" y2="12" />
                <line x1="8" y1="18" x2="21" y2="18" />
                <line x1="3" y1="6" x2="3.01" y2="6" />
                <line x1="3" y1="12" x2="3.01" y2="12" />
                <line x1="3" y1="18" x2="3.01" y2="18" /></svg>
            </button>
            <button class="view-btn grid-view active" title="Grid View">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-grid">
                <rect x="3" y="3" width="7" height="7" />
                <rect x="14" y="3" width="7" height="7" />
                <rect x="14" y="14" width="7" height="7" />
                <rect x="3" y="14" width="7" height="7" /></svg>
            </button>
          </div>
        </div>
        
      </div>


 
     

        <div class="join">
            <button id="modalbtn" class="btn btn-join"  style="visibility: hidden;">
            </button>
          </div>
          <div class="overlay">
            <div class="modal__locked">
              <div class="modal-body">
                <center>
                  <strong>حذف حساب کاربری</strong>
                  <br/>
                  <h7 style="text-align:right">آیا برای حذف حساب کاربری اطمینان دارید؟
                    <br/>
                    :حساب کاربری زیر حذف می شود
                </h7>
               <br/>   
        <h8 id="delacc">
            
        </h8>
        <br/>
        
                </center>
              </div>
              <div class="modal-buttons">
                <button class="btn btn-footer btn-purple" ><h6>انصراف</h6></button>
                <button class="btn btn-footer btn-purple" onclick="deleteUser(document.getElementById('delselect').innerHTML)" ><h6>حذف حساب </h6></button>
        
              </div>
            </div>
          </div>


          <p id="delselect" style="visibility: hidden;"></p>
          <script>
            loadUserInfo();
                function loadUserInfo(){
                var detailArr={};
                var xmlhttp;
                if(window.XMLHttpRequest){
                 xmlhttp=new XMLHttpRequest;
                }
                else{
                    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                }
                xmlhttp.onreadystatechange=respond;
                function respond (){
                
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
                  
                  var response = JSON.parse(this.responseText);
                    if(response.code == 200){
                      
                        console.log(response);
    var info = response.object;
   
    let fName =info.fName;
    let lName =info.lName;
    
    document.getElementById("adminName").innerHTML = fName+" "+lName;
           
           
            
                        
                        
                    
                     
                    }else {
                      window.location = 'welcome.html';
                
                    }
                    }
                
                    else if(xmlhttp.status==403||xmlhttp.status==404)
    {
        window.location.assign('/ttcu/Pages/login/login.html');
    } else{
                  console.log("Wait");
                
                }
                
                }
                
                
                xmlhttp.open('GET','http://127.0.0.1:8082/api/getUserInfo',true);
                xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
                xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));
                
                xmlhttp.send(JSON.stringify(detailArr));
                }
                
                </script>


<script>
    loadUserS();
        function loadUserS(){
        var detailArr={};
        detailArr["uni"]=localStorage.getItem("uni");
        detailArr["major"]=localStorage.getItem("major");

        var xmlhttp;
        if(window.XMLHttpRequest){
         xmlhttp=new XMLHttpRequest;
        }
        else{
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange=respond;
        function respond (){
        
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
          
          var response = JSON.parse(this.responseText);
            if(response.code == 200){
                let len = response.object.length;
                var color=0;
                let text ="";
                var teachers=0;
                var students=0;
                for (let i = 0; i < len; i++) {
                    var userType=response.object[i].userType;
                    if(color==5) color=0;
                    console.log(color);
                    if(userType!="ADMIN" && userType!="MASTER")
                    {
                        if(userType=="STUDENT") students+=1;
                        else teachers+=1;
                    text+="<div class='project-box-wrapper'>"+
        "<div class='project-box' style='background-color:"+ choosecolor(color)+";'>"+
          "<div class='project-box-header'>"+
            "<span></span>"+
            "<div class='more-wrapper'>"+
              "<button onclick='deleteselector("+i+")' class='btns btn-join'>"+
                "<img src='https://img.icons8.com/ios/50/000000/delete-user-male.png' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-more-vertical'>"+
                "<circle cx='12' cy='12' r='1' />"+
                  "<circle cx='12' cy='5' r='1' />"+
                  "<circle cx='12' cy='19' r='1' /></svg>"+
              "</button>"+
            "</div>"+
          "</div>"+

        
          "<div class='project-box-content-header'>"+
            "<p id='user"+i+"' class='box-content-header'>"+response.object[i].username+"</p>"+
            "<p id='user"+i+"' class='box-content-header'>"+convertUserType(response.object[i].userType)+"</p>"+
            "<p class='box-content-subheader'>"+response.object[i].fName+" "+ response.object[i].lName +"</p>"+
            "<p class='box-content-subheader'>"+ convertUni(localStorage.getItem('uni'))+"</p>"+
            "<p class='box-content-subheader'>"+ convertMajor(localStorage.getItem('major'))+"</p>"+
          "</div>"+
          "<div class='box-progress-wrapper'></div>"+

          
          "<div class='project-box-footer'>"+
            "<div class='participants'>"+
     
            "</div>"+

          "</div>"+       
        "</div>"+
      "</div>";
      
      color+=1;
            }
            
                }
                document.getElementById("users").innerHTML+=text;
               document.getElementById("teachers").innerHTML=teachers;
               document.getElementById("students").innerHTML=students;
               document.getElementById("posts").innerHTML=localStorage.getItem("posts");
    
                
                
            
             
            }else {
              window.location = 'welcome.html';
        
            }
            }
        
        else if( xmlhttp.status == 403){
        window.location = '../../../login/login.html';
      
      } else{
          console.log("Wait");
        
        }
        
        }
        
        
        xmlhttp.open('POST','http://127.0.0.1:8082/api/findUsers',true);
        xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
        xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));
        
        xmlhttp.send(JSON.stringify(detailArr));
        }
        
        </script>

<script>

    function deleteUser(i){
console.log("i"+i);
    
    var user = document.getElementById("user"+i).innerHTML;
  
    var detailArr={};
    detailArr["username"]=user;
    console.log(JSON.stringify(detailArr));
    var xmlhttp;
    if(window.XMLHttpRequest){
     xmlhttp=new XMLHttpRequest;
    }
    else{
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
    xmlhttp.onreadystatechange=respond;
    function respond (){
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
      
      var response = JSON.parse(this.responseText);
        if(response.code == 200){
           
          location.reload();
         
        }else {
          window.location = 'welcome.html';
    
        }
    
    }
    else if( xmlhttp.status == 403){
      window.location = '../../../login/login.html';
    
    }
    
    else{
      console.log("Wait");
    
    }
    
    }
    
    
    xmlhttp.open('POST','http://127.0.0.1:8082/api/admin/deleteUser',true);
    xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
    xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));
    
    xmlhttp.send(JSON.stringify(detailArr));
    }
  
  
    
    </script>
<script>
    function choosecolor(i) {
        const cars = ["#fee4cb", "#e9e7fd", "#ffd3e2","#c8f7dc","#d5deff"];
     return cars[i];
    }
  </script>
  <script>
      function deleteselector(i)
      {
          console.log("delete user"+i);
            document.getElementById("delselect").innerHTML=i;
            document.getElementById("delacc").innerHTML+=document.getElementById("user"+i).innerHTML;
            document.getElementById("modalbtn").click();
      }
  </script>
          
<script src="/ttcu/src/app/enumConverter.js"></script>
<script src="/ttcu/src/app/modal.js"></script>
 <script src="/ttcu/src/app/scroll.js"></script>
  <script src="/ttcu/public/darkmode/darkmod.js"></script>
  <script src="admin.js"></script>

</body>
</html>