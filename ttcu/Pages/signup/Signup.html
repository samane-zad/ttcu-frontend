
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet"   href="signup.css">
  <link rel="stylesheet"   href="../../src/css/modal.css">
  <link rel="stylesheet"   href="/ttcu/src/select-option.css">
  <link rel=icon  href="16X16.ico" >
  <link rel=icon href="../../src/Logo/ttcu-icon.ico">
  <script src="/ttcu/Pages/login/hide-password.js"></script>


  <title>ثبت نام </title>
</head>
<body>
  
  <div id="container">
    <div id="left"> </div>

    <div id="right">

      <p class="signup">ثبت نام</p>

   
   
      <p id="link"> ثبت نام کرده اید؟ <a href="/ttcu/Pages/login/login.html">ورود</a></p>
 

      <form action="" method="POST" class="form" autocomplete="off">

        <div class="form-control">
            <label for="username"><em style="color: red;">*</em>نام کاربری</label>
            <input type="text" id="username" type=text name="username"  id="username" placeholder="نام کاربری خود را وارد کنید"  id="username" class="client-info"    dir="rtl"  >
            <small>Error</small>
      </div>


      <div class="form-control">
        <label for="fName"><em style="color: red;">*</em>نام</label>
        <input  type="text" id="fName" placeholder="نام خود را وارد کنید" name="fname" id="fName" class="client-info" dir="rtl">
        <small>Error</small>
  </div>



  <div class="form-control">
        <label for="lName"><em style="color: red;">*</em>نام خانوادگی</label>
    <input type="text" placeholder="نام خانوادگی خود را وارد کنید " name="lName" id="lName" class="client-info"  dir="rtl"   >
    <small>Error</small>

</div>

<div class="form-control">
    <label for="password"><em style="color: red;">*</em>گذرواژه</label>
    <input type="password" name="password" id="password" placeholder="گذرواژه" class="client-info"   dir="rtl"/>
   <small>Error</small>
</div>

<div class="checkbox" >
<input type="checkbox" onclick="myFunction()"   > 
نمایش گذرواژه
</div>


  
  
<div class="form-control">
      <label for="confirm-password"><em style="color: red;">*</em>تایید گذرواژه</label>
    <input type="password" id=confirm-password placeholder="تاییدگذرواژه" class="client-info"   dir="rtl" >

    <small>Error</small>

  </div>









  <div class="form-control">
                <select id=uni dir="rtl" class="client-info">
                <option value="" disabled="disabled" selected="selected">دانشگاه خود را انتخاب کنید<em style="color: red;">*</em></option>
                <option value="SHARIATY_TECHNICAL_COLLEGE">دانشکده فنی دکتر شریعتی</option>
                <option value="VALIASR_TECHNICAL_COLLEGE"> دانشکده فنی ولیعصر</option>
                <option value="ENGHELAB_TECHNICAL_COLLEGE">دانشکده فنی انقلاب اسلامی</option>
                <option value="SHAMSIPOUR_TECHNICAL_COLLEGE">دانشکده فنی شمسی پور</option>
            </select>
         
            <small>Error</small>
          </div>



          <div class="form-control">
            <select id="major"  dir="rtl" class="client-info" >
                <option value="" disabled="disabled" selected="selected">رشته خود را انتخاب کنید <em style="color: red;">*</em></option>
                <option value="SOFTWARE">نرم افزار</option>
                <option value="ELECTRONICS">الکترونیک</option>
                <option value="MECHANICS">مکانیک</option>
                <option value="ICT">ICT</option>
               <option value="ARCHITECTURE">نقشه کشی معماری</option>   
               <option value="GRAPHICS">گرافیک</option>
               <option value="ACCOUNTING">حسابداری</option>
               <option value="CLOTHING_DESIGN">طراحی دوخت</option>
               <option value="PHYSICAL_EDUCATION">تربیت بدنی</option>
               <option value="IT">IT</option>
              </select>
            <small>Error</small>
          </div>




          <div class="form-control">
<select id="userType"  name="Usertypes" dir="rtl" class="client-info">
<option value="" disabled="disabled" selected="selected">نوع کاربر را انتخاب کنید<em style="color: red;">*</em></option>
<option value="ADMIN">مدیر گروه</option>
<option value="MASTER">مدیر </option>
<option value="TEACHER">استاد</option>
<option value="STUDENT">دانشجو</option>
</select>

            <small>Error</small>
          </div>




          <a href="/ttcu/Pages/user/html/index/index.html" ><p class="linkhome" >بازگشت به خانه</p> </a>   

          <button type="submit" id="submit"   class="sbmt" onclick="signUp()"  >ثبت</button>
         


   
  <!-- SVG Sprites-->
  <svg class="sprites">
    <symbol id="select-arrow-down" viewbox="0 0 10 6">
      <polyline points="1 1 5 5 9 1"></polyline>
    </symbol>
  </svg>
  
    </div>
  <!--<button  class="client-info"  id="get-btn">Get data</button>
  <button  class="client-info"   id="post-btn">Post data</button>-->
  
  </form>
    </div>
  </div>
  <div class="join">
    <button id="modalbtn" class="btn btn-join" style="visibility: hidden;">
      ورود
      </button>
</div>
  <div class="overlay">
    <div class="modal__locked">
      <div class="modal-body">
        <center>
          <strong>ثبت نام با موفقیت انجام شد</strong>
          
          <h4>
              لطفا اطلاعات زیر را برای ورود به سیستم حفظ کنید
          </h4>
          <h5 id="signedUpUser"> <script>document.getElementById("username").value</script></h5>
          <h5 id="signedUpPass">رمز عبور : <script>document.getElementById("password").value</script></h5>
          <h5 id="signedUpType">نوع کاربر: <script>document.getElementById("userType").value</script></h5>

        </center>
      </div>
      <div class="modal-buttons">
        <button class="btn btn-footer btn-purple">بستن</button>
      </div>
    </div>
</div> 
  <script>
    
    function signUp(){
    var detailArr={};

    var uniMajor={};
    uniMajor["uni"]=document.getElementById("uni").value;
    uniMajor["major"]=document.getElementById("major").value;

    detailArr["username"]=document.getElementById("username").value;
    detailArr["password"]=document.getElementById("password").value;
    detailArr["fName"]=document.getElementById("fName").value;
    detailArr["lName"]=document.getElementById("lName").value;
    detailArr["userType"]=[document.getElementById("userType").value];
    detailArr["uniMajor"]=uniMajor;
  

   var detailArrstr=JSON.stringify(detailArr);
   console.log(detailArrstr);
    var xmlhttp;
    if(window.XMLHttpRequest){
     xmlhttp=new XMLHttpRequest;
    }
    else{
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
xmlhttp.onreadystatechange=respond;
function respond (){

    if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
      
      var resonse = JSON.parse(this.responseText);
        if(resonse.code == 200){
          document.getElementById("signedUpUser").innerText=detailArr["username"]+" :نام کاربری";
          document.getElementById("signedUpPass").innerText=detailArr["password"]+" :رمز عبور ";
          document.getElementById("signedUpType").innerText="نوع کاربری: "+convertUserType(document.getElementById("userType").value);

          document.getElementById("modalbtn").click();
        }else {
          window.location = 'welcome.html';

        }

    }

    else{
      console.log("Hello");

    }
  
}


xmlhttp.open('POST','http://127.0.0.1:8082/auth/signUp',true);
xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));

xmlhttp.send(detailArrstr);
}

  </script>


<script>
  loadUserInfo();
      function loadUserInfo(){
      var detailArr={};
      var xmlhttp;
      if(window.XMLHttpRequest){
       xmlhttp=new XMLHttpRequest;
      }
      else{
          xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
      }
      xmlhttp.onreadystatechange=respond;
      function respond (){
      
      if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
        
        var response = JSON.parse(this.responseText);
          if(response.code == 200){
            
              var info = response.object;
              let userType=info.userType;
              if(userType!='ADMIN'&&userType!='MASTER')
              {
                window.location = '../Login/login.html';
              }
             
              
          
           
          }else {
            window.location = 'welcome.html';
      
          }
          }
      
      else if( xmlhttp.status == 403){
      window.location = '../Login/login.html';
    
    } else{
        console.log("Wait");
      
      }
      
      }
      
      
      xmlhttp.open('GET','http://127.0.0.1:8082/api/getUserInfo',true);
      xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
      xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));
      
      xmlhttp.send(JSON.stringify(detailArr));
      }
      
      </script>

      
  <script src="signup.js"></script>
  <script src="../../src/app/enumConverter.js"></script>
  <script src="../../src/app/modal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</body>
</html>

